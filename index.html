<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopping App</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <div class="logo">
    <p>KYOSK</p>
  </div>

  <nav>
    <ul>
      <li><a href="#">Home</a></li>
      <li><a href="#">Cart</a></li>
    </ul>
  </nav>

  <h1>Products</h1>
  <ul id="product-list"></ul>

  <h1>Cart</h1>
  <table id="cart-items">
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr>
        <td colspan="3">Total:</td>
        <td id="cart-total"></td>
        <td><button id="update-cart-btn">Update cart</button></td>
        <td><button id="buy">BUY</button></td>
      </tr>
    </tfoot>
  </table>
  <h1>Client Info</h1>
  <form id="client-info-form">
    <label for="payment-method">Payment Method:</label>
    <select id="payment-method" name="payment-method">
      <option value="M-PESA">M-PESA</option>
      <option value="MASTERCARD">MASTERCARD</option>
      <option value="CREDITCARD">CREDIT CARD</option>
      <option value="VISACARD">VISA CARD</option>
    </select>
    <br>
    <label for="phone-number">Phone number:</label>
    <input type="text" id="phone-number" name="phone-number" placeholder="eg.0123456789">
    <br>
    <label for="name">Name:</label>
    <input type="text" id="name1" name="name" placeholder="eg. Brax Levy">
    <br>
    <label for="location">Location:</label>
    <input type="text" id="location" name="location" placeholder="eg.Nairobi">
    <br>
    <button type="submit">Submit</button>
  </form>
  <h1>Post Product</h1>
  <form id="post-product-form">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name">
    <br>
    <label for="description">Description:</label>
    <input type="text" id="description" name="description">
    <br>
    <label for="price">Price:</label>
    <input type="number" id="price" name="price" step="1">
    <br>
    <button type="submit">Post</button>
  </form>

  <script>
    // Variables
    const productList = document.querySelector('#product-list');
    const cartItems = document.querySelector('#cart-items tbody');
    const updateCartBtn = document.querySelector('#update-cart-btn');
    const postProductForm = document.querySelector('#post-product-form');

    let products = []; 
    let cart = []; 

    // Fetch products from server
    fetch('http://localhost:3000/items')
      .then(response => response.json())
      .then(data => {
        products = data;
        displayProducts();
      });

    // Display products on page
function displayProducts() {
   products.forEach(product => {
      const item = document.createElement('li');
      item.innerHTML = `
      <h2>${product.name}</h2>
      <p>${product.description}</p>
      <p>Price: Ksh.${product.price.toFixed(2)}</p>
      <button class="add-to-cart" data-id="${product.id}">Add to cart</button>
      <button class="delete-product" data-id="${product.id}">Delete</button>
    `;
      productList.appendChild(item);

    // Add event listener to "Add to cart" button
    const addToCartBtn = item.querySelector('.add-to-cart');
    addToCartBtn.addEventListener('click', () => {
      const id = parseInt(addToCartBtn.dataset.id);
      addToCart(id);
    });
    // Add event listener to 'Delete' button 
    const deleteProductBtn = item.querySelector('.delete-product');
    deleteProductBtn.addEventListener('click', () => {
      const id = parseInt(deleteProductBtn.dataset.id);
      deleteProduct(id);
});
  });
}
// Add item to cart
function addToCart(id) {
const productToAdd = products.find(product => product.id === id);
const itemInCart = cart.find(item => item.id === id);

if (itemInCart) {
// If item is already in cart, increase quantity
itemInCart.quantity++;
} else {
// If item is not in cart, add to cart with quantity of 1
cart.push({
id: productToAdd.id,
name: productToAdd.name,
description: productToAdd.description,
price: productToAdd.price,
quantity: 1
});
}

updateCart();
}
const buyBtn = document.querySelector('#buy');
buyBtn.addEventListener('click', (event) => {
  event.preventDefault();
  const message = document.createElement('div');
  message.textContent = "Thank you for shopping with us. You were served by SAMUEL.";
  document.body.appendChild(message);
  setTimeout(() => {
    document.body.removeChild(message);
  }, 3000);
  // Reload page
  setTimeout(() => {
    location.reload();
  }, 3000);
});
// Delete product from server and remove from page
function deleteProduct(id) {
fetch(`http://localhost:3000/items/${id}`, { method: 'DELETE' 
})
.then(response => response.json())
.then(() => {
products = products.filter(product => product.id !== id);

  // Remove product from page
  const itemToRemove = productList.querySelector(`[data-id="${id}"]`);
  productList.removeChild(itemToRemove);
})
.catch(error => console.error(`Error deleting product: ${error}`));
}
// Update cart
function updateCart() {
// Clear cart items
cartItems.innerHTML = '';
// Update cart items in table
cart.forEach(item => {
  const row = document.createElement('tr');
  row.innerHTML = `
    <td>${item.name}</td>
    <td>${item.description}</td>
    <td>Ksh.${item.price.toFixed(2)}</td>
    <td><input type="number" min="1" value="${item.quantity}" data-id="${item.id}" class="item-quantity"></td>
    <td><button class="remove-item" data-id="${item.id}">Remove</button></td>
  `;
  cartItems.appendChild(row);
});
// Add event listener to "Remove" button
const removeItemBtn = row.querySelector('.remove-item');
removeItemBtn.addEventListener('click', () => {
  const id = parseInt(removeItemBtn.dataset.id);
  removeFromCart(id);
});
// Add event listener to quantity input
const quantityInput = row.querySelector('.item-quantity');
quantityInput.addEventListener('input', () => {
  const id = parseInt(quantityInput.dataset.id);
  updateItemQuantity(id, parseInt(quantityInput.value));
});

};

</script>
</body>
</html>
